# Author Vincent ROCHER
# Snakemake pipeline who generate predictions on whole genome for a list of tools
# Each tool is configured in a rule and each rule generate an output, usually the score for each sequence in input fasta



OUT = "results/" # Where the output are written
#rule to generate binned region of 201 bp, get accessibility data from it, for each bigwig
rule bin_genome:
	output:
		fasta = "data/binned_genome.Fa",
		bed = "data/binned_genome.bed"
	benchmark:
		OUT+"benchmarks/bin_genome.benchmark"
	conda: "../envs/fasta.yaml"
	script:
		bin_genome_R


rule fasta_atac_from_genome:
	input:
		genome = "data/binned_genome.Fa",
		atac_data = GetATAC
	output:
		atac_merged = OUT+"{sample}/fasta/merged/{sample}_atac_merged.rds",
	params:random_regions = "bed/random_region_for_scaling_min_max.bed"
	benchmark:
		OUT+"benchmarks/{sample}/{sample}_bed_merged.benchmark"
	conda: "../envs/fasta.yaml"
	script:
		generate_fasta_atac_from_bed


rule subseq_fasta:
	input:
		fasta = "data/binned_genome.Fa"
	output:
		fasta_trimmed = "data/binned_genome_trimmed.Fa"
	benchmark:
		OUT+"benchmarks/binned_genome_trimmed.benchmark"
	params:
		sub = 200
	conda: "../envs/fasta.yaml"
  	shell:
		"Rscript "+subseq_fasta+" {params.sub} {input.fas} {output.fasta_trimmed}"


#